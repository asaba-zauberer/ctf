{
  "meta": {
    "name": "01-easy",
    "version": "1.1",
    "defaultOutput": "text",
    "description": "Challenge 01."
  },
  "initialState": {
    "region": "",
    "env": {},
    "identities": [
      {
        "id": "appsec.emi.tanaka",
        "accountId": "111111111111",
        "arn": "arn:aws:iam::111111111111:user/appsec.emi.tanaka",
        "policies": [
          "s3:ListAllMyBuckets",
          "s3:ListBucket",
          "s3:GetObject",
          "iam:GetUser",
          "iam:ListAttachedUserPolicies",
          "iam:GetPolicy",
          "iam:ListPolicyVersions",
          "iam:GetPolicyVersion"
        ],
        "userName": "appsec.emi.tanaka"
      }
    ],
    "activeIdentity": "appsec.emi.tanaka",
    "custom": {
      "bucket": "s3pub-appsec-dev-202510-a7f3",
      "backupBucket": "s3pub-appsec-dev-202510-b5c2",
      "flagKey": "flag.txt",
      "flag": "flag{dummy-flag-123}",
      "readme": "Tip: Use '-' to stream to stdout (e.g., aws s3 cp s3://s3pub-appsec-dev-202510-a7f3/flag.txt -)"
    }
  },
  "commands": [
    {
      "match": {
        "equals": "aws sts get-caller-identity"
      },
      "response": {
        "render": "json",
        "json": {
          "UserId": "AIDACTFS3PUB0001",
          "Account": "111111111111",
          "Arn": "arn:aws:iam::111111111111:user/appsec.emi.tanaka"
        }
      }
    },
    {
      "match": {
        "regex": "^aws\\s+configure\\s+set\\s+region\\s+us-east-1$"
      },
      "mutateState": [
        {
          "op": "set",
          "path": "region",
          "value": "us-east-1"
        }
      ],
      "response": {
        "text": ""
      }
    },
    {
      "match": {
        "regex": "^export\\s+AWS_DEFAULT_REGION=us-east-1$"
      },
      "mutateState": [
        {
          "op": "set",
          "path": "env.AWS_DEFAULT_REGION",
          "value": "us-east-1"
        },
        {
          "op": "set",
          "path": "region",
          "value": "us-east-1"
        }
      ],
      "response": {
        "text": ""
      }
    },
    {
      "match": {
        "regex": "^aws\\s+iam\\s+get-user\\s*$"
      },
      "response": {
        "render": "json",
        "json": {
          "User": {
            "UserName": "appsec.emi.tanaka",
            "Arn": "arn:aws:iam::111111111111:user/appsec.emi.tanaka",
            "CreateDate": "2025-10-04T00:00:00+00:00"
          }
        }
      }
    },
    {
      "match": {
        "regex": "^aws\\s+iam\\s+list-attached-user-policies\\s+--user-name\\s+appsec\\\\.emi\\\\.tanaka\\s*$"
      },
      "response": {
        "render": "json",
        "json": {
          "AttachedPolicies": [
            {
              "PolicyName": "s3pub-list-get",
              "PolicyArn": "arn:aws:iam::111111111111:policy/s3pub-list-get"
            }
          ]
        }
      }
    },
    {
      "match": {
        "regex": "^aws\\s+iam\\s+get-policy\\s+--policy-arn\\s+arn:aws:iam::111111111111:policy/s3pub-list-get\\s*$"
      },
      "response": {
        "render": "json",
        "json": {
          "Policy": {
            "PolicyName": "s3pub-list-get",
            "Arn": "arn:aws:iam::111111111111:policy/s3pub-list-get",
            "DefaultVersionId": "v1",
            "AttachmentCount": 1,
            "CreateDate": "2025-09-28T00:00:00+00:00",
            "UpdateDate": "2025-09-28T00:00:00+00:00"
          }
        }
      }
    },
    {
      "match": {
        "regex": "^aws\\s+iam\\s+list-policy-versions\\s+--policy-arn\\s+arn:aws:iam::111111111111:policy/s3pub-list-get\\s*$"
      },
      "response": {
        "render": "json",
        "json": {
          "Versions": [
            {
              "VersionId": "v1",
              "IsDefaultVersion": true,
              "CreateDate": "2025-09-28T00:00:00+00:00"
            }
          ]
        }
      }
    },
    {
      "match": {
        "regex": "^aws\\s+iam\\s+get-policy-version\\s+--policy-arn\\s+arn:aws:iam::111111111111:policy/s3pub-list-get\\s+--version-id\\s+v1\\s*$"
      },
      "response": {
        "render": "json",
        "json": {
          "PolicyVersion": {
            "VersionId": "v1",
            "IsDefaultVersion": true,
            "Document": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AllowPublicBucketRead\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\"s3:ListBucket\", \"s3:GetObject\"],\n      \"Resource\": [\"arn:aws:s3:::s3pub-appsec-dev-202510-a7f3\", \"arn:aws:s3:::s3pub-appsec-dev-202510-a7f3/*\"]\n    }\n  ]\n}"
          }
        }
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+ls\\s*$"
      },
      "response": {
        "text": "2025-10-04 00:00:00 s3pub-appsec-dev-202510-a7f3\n2025-10-04 00:00:00 s3pub-appsec-dev-202510-b5c2\n"
      },
      "errorOnFail": {
        "errorCode": "UnknownOperation",
        "message": "You must specify a region. You can also configure your region by running 'aws configure'.",
        "exitCode": 255
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+ls\\s+s3://s3pub-appsec-dev-202510-a7f3/?$"
      },
      "response": {
        "text": "                           PRE assets/\n2025-10-04 00:00:00          87 readme.txt\n2025-10-04 00:00:00          12 flag.txt\n2025-10-04 00:00:00          64 flag.txt.gpg\n"
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+ls\\s+s3://s3pub-appsec-dev-202510-a7f3/assets/?$"
      },
      "response": {
        "text": "2025-10-04 00:00:00         124 manual.pdf\n2025-10-04 00:00:00          42 notes.txt\n2025-10-04 00:00:00          33 checklist.md\n"
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+ls\\s+s3://s3pub-appsec-dev-202510-b5c2/?$"
      },
      "response": {
        "text": "2025-10-04 00:00:00          98 decoy-flag.txt\n"
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+cp\\s+s3://s3pub-appsec-dev-202510-a7f3/readme.txt\\s+-\\s*$"
      },
      "response": {
        "text": "Tip: Use '-' to stream to stdout (e.g., aws s3 cp s3://s3pub-appsec-dev-202510-a7f3/flag.txt -)\n"
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3api\\s+head-object\\s+--bucket\\s+s3pub-appsec-dev-202510-a7f3\\s+--key\\s+flag.txt\\s*$"
      },
      "response": {
        "render": "json",
        "json": {
          "AcceptRanges": "bytes",
          "LastModified": "2025-10-04T00:00:00+00:00",
          "ContentLength": 19,
          "ETag": "\"3f5d8c6f9b3d2a0e7a4c6f2c1d9e1234\"",
          "ContentType": "text/plain",
          "Metadata": {
            "hint": "use-stdout"
          }
        }
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+cp\\s+s3://s3pub-appsec-dev-202510-a7f3/flag.txt\\s+-\\s*$"
      },
      "response": {
        "text": "flag{dummy-flag-123}\n"
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+cp\\s+s3://s3pub-appsec-dev-202510-a7f3/flag.txt\\s*$"
      },
      "response": {
        "text": "usage: aws s3 cp <S3Uri> <LocalPath|-> [--recursive] [--exclude] [--include] [...]\n"
      },
      "errorOnFail": {
        "errorCode": "UnknownOperation",
        "message": "missing required argument: destination",
        "exitCode": 255
      }
    },
    {
      "match": {
        "regex": "^aws\\s+s3\\s+cp\\s+s3://s3pub-appsec-dev-202510-b5c2/decoy-flag.txt\\s+-\\s*$"
      },
      "response": {
        "text": "not_a_flag{nice-try}\n"
      }
    }
  ],
  "fallbackError": {
    "errorCode": "UnknownOperation",
    "message": "An error occurred. See 'aws --help'.",
    "exitCode": 255
  }
}